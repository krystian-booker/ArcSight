{% extends "layouts/base.html" %}
{% block title %}Settings{% endblock %}
{% block content %}
<div x-data="settingsApp()" x-cloak class="stack stack-2xl">
    <header class="stack stack-sm">
        <h1>Settings</h1>
        <p class="muted text-small">Configure network identity, GenICam integration, and device-level controls for ArcSight deployments.</p>
    </header>

    <section class="panel stack stack-lg">
        <h2 class="panel-title">Global Settings</h2>
        <form action="{{ url_for('settings.update_global_settings') }}" method="POST" class="stack stack-lg">
            <div class="grid-2 grid-tight">
                <div class="form-field">
                    <label class="form-label" for="team-number">Team Number</label>
                    <input
                        type="number"
                        name="team_number"
                        id="team-number"
                        value="{{ settings.team_number or '' }}"
                        class="form-control"
                    >
                </div>
                <div class="form-field">
                    <label class="form-label" for="hostname">Hostname</label>
                    <input
                        type="text"
                        name="hostname"
                        id="hostname"
                        value="{{ current_hostname }}"
                        class="form-control"
                    >
                </div>
            </div>

            <fieldset class="stack stack-sm">
                <legend class="form-label">IP Assignment Mode</legend>
                <div class="cluster cluster-wrap">
                    <label class="cluster text-small">
                        <input
                            type="radio"
                            name="ip_mode"
                            value="DHCP"
                            class="form-checkbox"
                            {% if current_network_settings.ip_mode == 'DHCP' %}checked{% endif %}
                        >
                        <span>DHCP</span>
                    </label>
                    <label class="cluster text-small">
                        <input
                            type="radio"
                            name="ip_mode"
                            value="Static"
                            class="form-checkbox"
                            {% if current_network_settings.ip_mode == 'Static' %}checked{% endif %}
                        >
                        <span>Static</span>
                    </label>
                </div>
            </fieldset>

            <div class="cluster justify-end">
                <button type="submit" class="button button--primary">
                    Save Global Settings
                </button>
            </div>
        </form>
    </section>

    <section class="panel stack stack-lg">
        <h2 class="panel-title">GenICam Settings</h2>
        <form action="{{ url_for('settings.update_genicam_settings') }}" method="POST" class="stack stack-lg">
            <div class="form-field">
                <label class="form-label" for="genicam-cti-path">GenTL Producer Path (.cti file)</label>
                <span class="muted text-small">Current: {{ settings.genicam_cti_path or 'Not set' }}</span>
                <input
                    type="text"
                    id="genicam-cti-path"
                    name="genicam-cti-path"
                    placeholder="C:\\path\\to\\your\\genicam.cti"
                    class="form-control"
                >
                <p class="form-hint">Enter the full path to the .cti file from your camera SDK. ArcSight requires this to communicate with GenICam hardware.</p>
            </div>
            <div class="cluster justify-end">
                <button type="submit" class="button button--primary">
                    Save GenICam Settings
                </button>
            </div>
        </form>
    </section>

    <section class="panel stack stack-lg">
        <h2 class="panel-title">Device Control</h2>
        <div class="grid-2 grid-tight">
            <button type="button" class="button button--primary" @click="submitPost('{{ url_for('settings.restart_app') }}')">
                Restart ArcSight
            </button>
            <button type="button" class="button button--primary" @click="submitPost('{{ url_for('settings.reboot_device') }}')">
                Restart Device
            </button>
            <a href="{{ url_for('settings.export_db') }}" class="button">
                Export Configuration
            </a>
            <button type="button" class="button" @click="triggerImport">
                Import Configuration
            </button>
        </div>
        <button type="button" class="button button--danger w-100" @click="openFactoryResetModal">
            Factory Reset
        </button>
        <form
            id="import-db-form"
            action="{{ url_for('settings.import_db') }}"
            method="POST"
            enctype="multipart/form-data"
            hidden
        >
            <input type="file" name="database" id="import-db-input" x-ref="importInput" @change="handleImportChange">
        </form>
    </section>

    <div
        class="modal-overlay"
        id="factoryResetModal"
        x-show="factoryResetOpen"
        x-transition
    >
        <div class="modal-content stack stack-lg">
            <header class="stack stack-xs">
                <h3>Confirm Factory Reset</h3>
                <p class="panel-hint">Factory reset deletes all cameras, settings, and cached data.</p>
            </header>
            <p>Are you sure you want to factory reset? This action cannot be undone.</p>
            <div class="cluster justify-end">
                <button type="button" class="button button--ghost" @click="closeFactoryResetModal">
                    Cancel
                </button>
                <button
                    type="button"
                    class="button button--danger"
                    @click="confirmFactoryReset('{{ url_for('settings.factory_reset') }}')"
                >
                    Factory Reset
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
