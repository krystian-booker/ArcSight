{% extends "layouts/base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}

<h1 class="text-3xl font-bold mb-4">Dashboard</h1>

<div class="flex flex-wrap md:flex-nowrap gap-4">
    <div class="w-full md:w-1/3">
        <div class="bg-gray-800 rounded-lg p-4">
            <h2 class="text-xl font-bold mb-4">Configuration</h2>
            <form id="camera-config-form">
                <div class="mb-4">
                    <label for="camera-select" class="block text-sm font-medium text-gray-300 mb-2">Select Camera</label>
                    <select id="camera-select" class="custom-select">
                        {% if cameras %}
                            {% for camera in cameras %}
                                <option value="{{ camera.id }}">{{ camera.name }}</option>
                            {% endfor %}
                        {% else %}
                            <option value="">No cameras configured</option>
                        {% endif %}
                    </select>
                </div>

                <div class="mb-4">
                    <label for="pipeline-select" class="block text-sm font-medium text-gray-300 mb-2">Pipeline</label>
                    <div class="flex items-center">
                        <select id="pipeline-select" class="custom-select w-full">
                            </select>
                        <button id="add-pipeline-btn" class="ml-2 btn btn-primary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 5a1 1 0 011 1v3h3a1 1 0 110 2h-3v3a1 1 0 11-2 0v-3H6a1 1 0 110-2h3V6a1 1 0 011-1z" clip-rule="evenodd" />
                            </svg>
                        </button>
                        <button id="edit-pipeline-btn" class="ml-2 btn btn-secondary">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z" />
                            </svg>
                        </button>
                        <button id="delete-pipeline-btn" class="ml-2 btn btn-danger">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm4 0a1 1 0 012 0v6a1 1 0 11-2 0V8z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
                </div>
                <div class="mb-4">
                    <label for="pipeline-type-select" class="block text-sm font-medium text-gray-300 mb-2">Pipeline Type</label>
                    <select id="pipeline-type-select" class="custom-select" {% if not cameras %}disabled{% endif %}>
                        <option>AprilTag</option>
                        <option>Coloured Shape</option>
                        <option>Object Detection (ML)</option>
                    </select>
                </div>
            </form>
        </div>
    </div>

    <div class="w-full md:w-1/3">
        <div class="bg-gray-800 rounded-lg p-4">
            <h2 class="text-xl font-bold mb-4">Input</h2>
            <div id="pipeline-forms">
            <div class="mb-4">
                <label for="orientation-select" class="block text-sm font-medium text-gray-300 mb-2">Orientation</label>
                <select id="orientation-select" class="custom-select">
                    <option value="0">Normal (0째)</option>
                    <option value="90">Rotate 90째</option>
                    <option value="180">Rotate 180째</option>
                    <option value="270">Rotate 270째</option>
                </select>
            </div>

            <div class="mb-4">
                <label for="exposure-mode-select" class="block text-sm font-medium text-gray-300 mb-2">Exposure</label>
                <select id="exposure-mode-select" class="custom-select mb-2">
                    <option value="auto">Auto</option>
                    <option value="manual">Manual</option>
                </select>
                <div class="flex items-center gap-4">
                    <input type="range" id="exposure-slider" min="0" max="1000" value="500" class="w-full" disabled>
                    <input type="number" id="exposure-value" min="0" max="1000" value="500" class="w-24 custom-select" disabled>
                </div>
            </div>

            <div class="mb-4">
                <label for="gain-mode-select" class="block text-sm font-medium text-gray-300 mb-2">Gain</label>
                <select id="gain-mode-select" class="custom-select mb-2">
                    <option value="auto">Auto</option>
                    <option value="manual">Manual</option>
                </select>
                <div class="flex items-center gap-4">
                    <input type="range" id="gain-slider" min="0" max="100" value="50" class="w-full" disabled>
                    <input type="number" id="gain-value" min="0" max="100" value="50" class="w-24 custom-select" disabled>
                </div>
            </div>
            </div>
        </div>
    </div>


    <div class="w-full md:w-1/3">
        <div id="video-feed-wrapper" class="video-feed-wrapper">
            <div class="bg-gray-800 rounded-lg p-4 h-full">
                <div class="camera-feed-container bg-black flex items-center justify-center rounded h-full">
                    {% if cameras %}
                        <img id="camera-feed" src="" alt="Camera Feed" class="w-full h-full object-contain rounded">
                    {% else %}
                        <p class="text-gray-500">No camera feed available.</p>
                    {% endif %}
                </div>
            </div>
        </div>
        <div class="mt-4 text-center">
            <label class="inline-flex items-center">
                <input type="radio" name="feed-type" value="default" checked>
                <span class="ml-2">Default Feed</span>
            </label>
            <label class="inline-flex items-center ml-6">
                <input type="radio" name="feed-type" value="processed">
                <span class="ml-2">Processed Feed</span>
            </label>
        </div>
    </div>
</div>

<div class="w-full bg-gray-800 rounded-lg p-4 mt-4">
    <div id="pipeline-forms">
        {% include 'partials/dashboard/_apriltag_form.html' %}
        {% include 'partials/dashboard/_coloured_shape_form.html' %}
        {% include 'partials/dashboard/_ml_form.html' %}
    </div>
</div>

{% include 'partials/_modals.html' %}


{% if cameras %}
<script type="module" src="{{ url_for('static', filename='js/pages/dashboard.js') }}"></script>
{% endif %}
{% endblock %}