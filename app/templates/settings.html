{% extends "layout.html" %}
{% block title %}Settings{% endblock %}
{% block content %}
<h1 class="text-3xl font-bold mb-4">Settings</h1>

<!-- Global Settings -->
<div class="bg-gray-800 rounded-lg p-4 mb-8">
    <h2 class="text-2xl font-bold mb-4">Global Settings</h2>
    <form action="{{ url_for('main.update_global_settings') }}" method="POST">
        <div class="space-y-4">
            <div>
                <label for="team-number" class="block text-sm font-medium text-gray-300">Team Number</label>
                <input type="number" name="team_number" id="team-number" value="{{ settings.team_number or '' }}" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-300">IP Assignment Mode</label>
                <div class="mt-2 space-x-4">
                    <label class="inline-flex items-center">
                        <input type="radio" name="ip_mode" value="DHCP" class="text-indigo-600 bg-gray-700 border-gray-600 focus:ring-indigo-500" {% if current_network_settings.ip_mode == 'DHCP' %}checked{% endif %}>
                        <span class="ml-2 text-sm text-gray-300">DHCP</span>
                    </label>
                    <label class="inline-flex items-center">
                        <input type="radio" name="ip_mode" value="Static" class="text-indigo-600 bg-gray-700 border-gray-600 focus:ring-indigo-500" {% if current_network_settings.ip_mode == 'Static' %}checked{% endif %}>
                        <span class="ml-2 text-sm text-gray-300">Static</span>
                    </label>
                </div>
            </div>
            <div>
                <label for="hostname" class="block text-sm font-medium text-gray-300">Hostname</label>
                <input type="text" name="hostname" id="hostname" value="{{ current_hostname }}" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            </div>
        </div>
        <div class="mt-6">
            <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
                Save Global Settings
            </button>
        </div>
    </form>
</div>

<!-- GenICam Settings -->
<div class="bg-gray-800 rounded-lg p-4 mb-8">
    <h2 class="text-2xl font-bold mb-4">GenICam Settings</h2>
    <form action="{{ url_for('main.update_genicam_settings') }}" method="POST">
        <div class="mb-4">
            <label for="genicam-cti-path" class="block text-sm font-medium text-gray-300">GenTL Producer Path (.cti file):</label>
            <span class="text-sm text-gray-400">Current: {{ settings.genicam_cti_path or 'Not set' }}</span>
            <input type="text" id="genicam-cti-path" name="genicam-cti-path" placeholder="C:\path\to\your\genicam.cti" class="mt-1 block w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white placeholder-gray-400 focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
            <p class="mt-2 text-sm text-gray-400">Enter the full path to the .cti file from your camera's SDK. The application needs this path to communicate with the camera.</p>
        </div>
        <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500">
            Save GenICam Settings
        </button>
    </form>
</div>

<!-- Device Control -->
<div class="bg-gray-800 rounded-lg p-4 mb-8">
    <h2 class="text-2xl font-bold mb-4">Device Control</h2>
    <div class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <button onclick="postToAction('{{ url_for('main.restart_app') }}')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">Restart Vision-Tools</button>
            <button onclick="postToAction('{{ url_for('main.reboot_device') }}')" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded w-full">Restart Device</button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <a href="{{ url_for('main.export_db') }}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded text-center w-full">Export Configuration</a>
            <button onclick="document.getElementById('import-db-input').click()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded w-full">Import Configuration</button>
        </div>
        <div>
            <button onclick="openFactoryResetModal()" class="bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded w-full">Factory Reset</button>
        </div>
    </div>
    <form id="import-db-form" action="{{ url_for('main.import_db') }}" method="POST" enctype="multipart/form-data" class="hidden">
        <input type="file" name="database" id="import-db-input" onchange="document.getElementById('import-db-form').submit()">
    </form>
</div>

<!-- Factory Reset Modal -->
<div id="factoryResetModal" class="modal-hidden">
    <div class="modal-overlay"></div>
    <div class="modal-content">
        <h3 class="text-lg font-bold mb-4">Confirm Factory Reset</h3>
        <p>Are you sure you want to factory reset? This will delete all settings and cameras and cannot be undone.</p>
        <div class="mt-6 flex justify-end space-x-4">
            <button onclick="closeFactoryResetModal()" class="px-4 py-2 bg-gray-600 hover:bg-gray-700 rounded-md text-white">Cancel</button>
            <button onclick="confirmFactoryReset()" class="px-4 py-2 bg-red-600 hover:bg-red-700 rounded-md text-white">Factory Reset</button>
        </div>
    </div>
</div>


<script>
function postToAction(url, confirmMsg) {
    if (confirmMsg && !confirm(confirmMsg)) {
        return;
    }
    const form = document.createElement('form');
    form.method = 'POST';
    form.action = url;
    document.body.appendChild(form);
    form.submit();
}

function openFactoryResetModal() {
    document.getElementById('factoryResetModal').classList.remove('modal-hidden');
}

function closeFactoryResetModal() {
    document.getElementById('factoryResetModal').classList.add('modal-hidden');
}

function confirmFactoryReset() {
    postToAction('{{ url_for('main.factory_reset') }}');
    closeFactoryResetModal();
}
</script>
{% endblock %}
